MOD_DIR="${MODS_DIR}/talk"
MOD_APK="${MOD_DIR}/talk.apk"

GEMINI_VENDOR="${ANDROID_ROOT}/vendor/xiaomi/gemini"

VENDOR_MK="${GEMINI_VENDOR}/gemini-vendor.mk"
ANDROID_MK="${GEMINI_VENDOR}/Android.mk"

MOD_APP_DIR="${GEMINI_VENDOR}/system/app/vocalizer"

out "App directory [${MOD_APP_DIR}]"
! d_exists "${MOD_APP_DIR}" && mkd "${MOD_APP_DIR}"

out "Copy Asset [${MOD_APK}]"
cp -v "${MOD_APK}" "${MOD_APP_DIR}/vocalizer.apk"

out "Backup vendor makefile  [${VENDOR_MK}] to [${MOD_DIR}/gemini-vendor.mk]"
cp -v "${VENDOR_MK}" "${MOD_DIR}/gemini-vendor.mk"

out "Backup android  makefile  [${ANDROID_MK}] to [${MOD_DIR}/Android.mk]"
cp -v "${ANDROID_MK}" "${MOD_DIR}/Android.mk"

append()
{
	echo "${@}"
	echo "${@}" >> "${ANDROID_MK}"
}

append ''
append 'ifeq ($(TARGET_DEVICE),gemini)'
append ''
append 'include $(CLEAR_VARS)'
append 'LOCAL_MODULE := vocalizer'
append 'LOCAL_MODULE_OWNER := xiaomi'
append 'LOCAL_SRC_FILES := system/app/vocalizer/vocalizer.apk'
append 'LOCAL_CERTIFICATE := platform'
append 'LOCAL_MODULE_TAGS := optional'
append 'LOCAL_MODULE_CLASS := APPS'
append 'LOCAL_MODULE_SUFFIX := .apk'
append 'LOCAL_PROPRIETARY_MODULE := true'
append 'LOCAL_MODULE_PATH := $(PRODUCT_OUT)/system/app'
append 'include $(BUILD_PREBUILT)'
append ''
append 'endif'
append ''

vappend()
{
	echo "${@}"
	echo "${@}" >> "${VENDOR_MK}"
}

vappend ''
vappend 'PRODUCT_PACKAGES += vocalizer'
vappend ''


MOD_DIR="${MODS_DIR}/talk"
MOD_APK="${MOD_DIR}/talk.apk"

GEMINI_VENDOR="${ANDROID_ROOT}/vendor/xiaomi/gemini"

VENDOR_MK="${GEMINI_VENDOR}/gemini-vendor.mk"
ANDROID_MK="${GEMINI_VENDOR}/Android.mk"

MOD_APP_DIR="${GEMINI_VENDOR}/system/app/vocalizer"

out "Remove directory [${MOD_APP_DIR}]"
d_exists "${MOD_APP_DIR}" && rm -rv "${MOD_APP_DIR}"

out "Restore vendor makefile  [${VENDOR_MK}] from  [${MOD_DIR}/gemini-vendor.mk]"
f_exists "${MOD_DIR}/gemini-vendor.mk" && mv -v "${MOD_DIR}/gemini-vendor.mk" "${VENDOR_MK}"

out "Restore android  makefile  [${ANDROID_MK}] from [${MOD_DIR}/Android.mk]"
f_exists "${MOD_DIR}/Android.mk" && mv -v "${MOD_DIR}/Android.mk" "${ANDROID_MK}"
